 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict //EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">

 <head>
  <title>lxnstack User Manual</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <link rel="stylesheet" type="text/css" href="usermanual.css"  media="screen"/>
 </head>

 <body>
  <div id=mainframe>
  <p><h1>User Manual</h1></p>
  
  <p>NOTE: This manual is a bit outdated. The updated manual will be released with the next program version.</p>
    
  <p><h2>Index:</h2></p>
  <!-- main index -->
  <p class="index">
   <ul>
    <li id="section" class="selector">       
     <a href="#introduction">Introduction</a>
    </li>
    <li id="section" class="selector">       
     <a href="#loading">Load files</a>
    </li>
    <li id="section" class="selector">       
     <a href="#capture">Webcam capture</a>
    </li>
    <li id="section" class="selector">
     <a href="#zoom">Display and zoom images</a>
    </li>
    <li id="section" class="selector">
     <a href="#selection">Images selection</a>
    </li>
    <li id="section" class="selector">
     <a href="#autoalignment">Automatic alignment</a>
    </li>
    <li id="section" class="selector">       
     <a href="#alignment">Manual alignment</a>
    </li>
    <li id="section" class="selector">       
     <a href="#dark_flat">Darkframe e Flatfield </a>
    </li>
    <li id="section" class="selector">       
     <a href="#addition">Average</a>
    </li>
    <li id="section" class="selector">       
     <a href="#preferences">Settings</a>
    </li>
    <li id="section" class="selector">       
     <a href="#notes">Notes</a>
    </li>
   </ul>
  </p>
  
  <!-- actual documentation -->
  <section id="introduction">
   <p><h1>Introduction</h1></p>
   <p>
    lxnstack is a software to align and stack astronomical images (both planetary and deep-sky)
    This program is open source and is distributed under the <a href="gpl-3.0.txt">GNU GPL version 3</a>
    license.
   </p>
   <p>
   The requisites to run this program correctly are (as already reported in the installation
   instructions):
    <ul>
     <li><a href="">'Python 2.7'</a> (in a terminal type "python2 --version" without quotes to verify
     the correct installation of python)</li>
     <li>The python2 package <a href="http://www.numpy.org/">'numpy'</a></li>
     <li>The python2 package <a href="http://www.scipy.org/">'scipy'</a></li>
     <li>The python2 package <a href="http://www.pythonware.com/products/pil/">'PIL'<a/></li>
     <li>The libraries <a href="http://opencv.org/">'opencv'</a> version 2</li>
     <li>The libraries <a href="http://qt-project.org">Qt4</a></li>
     <li>The python2 package <a href="http://www.riverbankcomputing.co.uk/software/pyqt/intro">'PyQt4'</a></li>
     <li>The package v4l-utils (actually, only the program v4l2-ctl is needed)</li>
     <li>The python2 package <a href="http://www.stsci.edu/institute/software_hardware/pyfits">'PyFits'</a> 
         [OPTIONAL: needed only to read/write FITS file]</li>
    </ul>
   </p>
  </section>
  
  <section id="loading">
   <p><h1>Load files</h1></p>
   <p>
    Click the menu 'File'->'Open files' or push the '+' button in the 'frames list' section
    and an open file dialog window will appear. There you can select the files to be loaded.
    All images must have the same size and the same number for color channels (for example you
    cannot add an RGB image with a gray-scale one).
   </p>
   <image src="imgs/main_window.png"></image>
   <p>
    You can open a video (for example a video captured with a webcam) by clicking the menu
    'File'->'Open video'. If you loaded other images, then each frame of the video
    must have the same size and the same number of color channels of the previously loaded images.
    At loading, the video is splitted into frames that are saved in a temporary directory
    ('/tmp/lxnstack' by default), so assure you have enough space for the operation.
   </p>
  </section>
  
  <section id="capture">
   <p><h1>Webcam capture</h1></p>
   <p>
    lxnstack can capture images from a video4linux device (like a webcam).
    Check the 'Capture' checkbox in the 'frames list' section to enable the video capture mode.
   </p>
   <p>
    <image src="imgs/capture_controls.png"></image>
   </p>
   <p>
    If no capture device has been selected yet ( see <a href="#preferences">Settings</a> )
    a dialog window will appear where you can choose an available device.
   </p>
   <p class="warning">
    WARNING: opencv libraries CANNOT HANDLE DEVICES USED BY OTHER PROGRAMS and this can lead
    to a crash! CLOSE ANY OTHER APPLICATION USING A CAPTURE DEVICES.
   </p>
   <p>
    If all is ok the capture controls will be enabled and a live preview will be shown.
   </p>
   <p>
    <image src="imgs/capture_controls_max.png"></image>
   </p>
   <p>
    Press 'Start' button to start capture and 'Stop' button to stop capture.
   </p>
   <p>
    To set the number of frames to capture, check the 'Max' checkbox and digit the number
    in the right spinbox.
   </p>
   <p>
    Press 'Single shot' to take a single shot.
   </p>
   
   <p>
    ATTENTION: remember to exit the capture mode by unchecking the 'Capture' checkbox when
    finished!
   </p>
  </section>
  
  <section id="zoom">
   <p><h1>Display and zoom images</h1></p>
   <p>
    To show an image you can simply select its name in the 'frames list' and it
    will be shown in the canvas on the right.
   </p>
   <p>
    <image src="imgs/file_loaded.png"></image>
   </p>
   <p>
    To modify the zoom you can use the 'zoom' controls
   </p>
   <p>
    <image src="imgs/zoom_controls.png"></image>
   </p>
   <p>
    Three types of zoom are available:
   </p>
   <p>
    zoom: none
   </p>
   <p>
    <image src="imgs/zoom_none.png"></image>
   </p>
   <p>
    zoom: fit
   </p>
   <p>
    <image src="imgs/zoom_fit.png"></image>
   </p>
   <p>
    zoom: full
   </p>
   <p>
    <image src="imgs/zoom_full.png"></image>
   </p>
  </section>
  
  <section id="selection">
   <p><h1>Images selection</h1></p>
   <p>
    You can choose the image to use in the average process by checking the checkbox on the left
    side of each image in the 'frames list'. The images with this checkbox unchecked will not be
    used.
   </p>
   <p>
    <image src="imgs/frames_checked.png"></image>
   </p>
   <p>
    In this way the unwanted images can be excluded.
   </p>
  </section>

  <section id="autoalignment">
   <p><h1>Automatic alignment</h1></p>   
   <p>
   Two types of alignment are available: the alignment method can be choosen by selecting it
   in the combobox.
   </p>
      
   <p>
   The actual alignment is performed by pushing the 'Align' button in the 'Tools' section.
  </p>
   
   <p><h2>Alignment by phase correlation</h2></p>
   <p>
    <image src="imgs/alignment_phase.png"></image>
   </p>
   <p>
   This method does not require any user action, just press the 'Align' button in the 'Tools'
   section to start the alignment process.
   If the images are misaligned, try to change the sharpness value.
   </p>
   
   <p><h2>Alignment by points</h2></p>
   <p>
    Push the '+' button to add an alignment point and the '-' button to remove the currently
    selected alignment point.
   </p>
   <p>
    <image src="imgs/alignment.png"></image>
   </p>
   <p>
    You can detect the best align points pushing the 'Automatic detection'. The points are 
    chosen by their quality (see <a href="#preferences">Settings</a> ).
   </p>
   <p>
    <image src="imgs/auto_points.png"></image>
   </p>
   <p>
    The current selected alignment point can be moved by clicking on the displayed image with the
    right mouse button or by using the spinboxes 'X offset' ed 'Y offset'.
   </p>
   <p>
    All align points must be set on all images in the same position.
    To do this an automatic positioning feature can be used: you can this process by pushing the
    'Set on all images' button. All points will be automatically detected on all images using the
    current shown image as reference. Only the points that have not been detected yet or that are
    been moved will be detected/re-detected.
   </p>
   <p>
    <image src="imgs/points_detection.png"></image>
   </p>
   <p>
    ATTENTION: avoid to place the alignment points near the image borders!
   </p>
   <p><h1>Manual alignment</h1></p>
   <p>
    An alternative manual alignment is available in the 'Manual alignment'.
    This method is based on a comparison of two images: a reference image can be selected by
    checking the checkbox on the left side of its name in the list while the image to be aligned
    can be selected simply clicking its name in the list with the left mouse button.
   </p>
   <p>
    <image src="imgs/manual_alignment.png"></image>
   </p>
   <p>
    The difference of the two images will be shown
   </p>
   <p>
    The lower is the difference the darker will be the image shown.
    The spinboxes 'X offset' and 'Y offset' can be used to move the image and align it to the
    reference image.
   </p>
  </section>
  
  <section id="dark_flat">
   <p><h1>Darkframe e Flatfield</h1></p>
   <p>
    In these sections the calibration images (master-dark and master-flatfield) can be selected
    or created.
   </p>
   <p>
    If you do not want to use calibration images, simply leave blank the two sections.
   </p>
   <p>
    NOTE: the best practice is to create first the master-dark as average of dark-images (skipping
          the alignment process), then create the master-flat as average of flat-images (skipping
          the alignment process) using the master-dark previously created (and scaled to adapt to the
          dynamic of the flat images) and at the end use both these two files to calibrate the images 
          you want to stack.
   </p>
   <p>
    The calibration images can be created by adding the single images to the respective lists.
   </p>
   <p>
    <image src="imgs/dark_list.png"></image>
    <image src="imgs/flat_list.png"></image>
   </p>
   <p>
    NOTE: If you want, when you load some images the directory in which they are located can be 
    scanned for the presence of the folders 'dark' and 'flat' by enabling the checkbox "Automatically
    scan for dark and flat frames" in the application settings.
    The images located in these directories will be added to the respective lists (for example if 
    you load some images from the directory '/home/images', the dark and flat images will be 
    searched in the directories '/home/images/dark' and '/home/images/flat').
   </p>
   <p>
    If you already made the calibration images (you can make them using this program by loading
    the dark/flat frames and adding them without aligning), you can check the 'Use master-dark'
    and/or 'Use master-flatfield' checkboxes and selecting the files clicking the '...' buttons
    or typing the full url of the files in the respective text box.
   </p>
   <p>
    <image src="imgs/dark_master.png"></image>
    <image src="imgs/flat_master.png"></image>
   </p>
   <p>
    Lastly you can choose a factor by which the master files will be multiplied before
    the calibration takes place (the value is 1 by default).
   </p>   
  </section>
  
  <section id="addition">
   <p><h1>Average</h1></p>
   <p>
    First of all you need to align the images (if you haven't done it yet) by pushing the
    'Align' button in the 'Tools' section. After the align process ends you can add the
    images using the 'Add' button.
   </p>
   <p>
    <image src="imgs/tools.png"></image>
   </p>
   <p>
    When the operation is ended the resulting average image will be shown.
   </p>
   <p>
    NOTE: The "exposure controls" tool has been removed because it does not work anymore
    since the computation is done using floating point numbers instead of integers.
    Moreover there are several image manupulation programs that provide similar functionalities.
   </p>
   <p>
    Here are shown a single image and the average of 33 images calibrated with a master-dark
    and a master-flatfield.
   </p>
   <p>
    <image src="imgs/zoom_none.png"></image>
    <image src="imgs/averaged.png"></image>
   </p>
  </section>
  
  <section id= "preferences">
   <p>
    The application settings are available trough the menu 'Options'->'Preferences'
   </p>
   <p>
    In the 'Settings' section you can choose the application language.
   </p>
   <p>
    <image src="imgs/preferences_settings.png"></image>
   </p>
   
   <p>
    The settings for automatic alignment can be changed in the 'Alignment' section:
    The 'rectangle size' controls the size of a portion of the image (centered on the alignment point
    and marked by a yellow rectangle) that is compared with the other images during the automatic
    positioning process ( see <a href="#autoalignment">Automatic alignment</a> ).
    By default this "rectangle" is compared with a limited portion of other images. If the
    image shift is excessive, the alignment points will not be correctly set: in this case it is
    useful to check the 'Use whole image to track points'. However also using the entire image method
    has its negative consequences: it is slower and there are more false positive detections.
   </p>
   <p>
    The maximum number of alignment points that can be detected automatically and their minimum quality
    can be changed in the 'Auto detection' box (For more information refer to opencv user manual and
    search for "goodFeaturesToTrack").
   </p>
   <p>
    <image src="imgs/preferences_alignment.png"></image>
   </p>
   
   <p>
    The capture device can be chosen in the 'Capture devices' section.
    The basic device settings can be also changed.
    Use the programv4l2-ctl to change other settings.
   </p>
   <p class="warning">
    WARNING: opencv libraries CANNOT HANDLE DEVICES USED BY OTHER PROGRAMS and this can lead
    to a crash! CLOSE ANY OTHER APPLICATION USING A CAPTURE DEVICES.
   </p>
   <p class="warning">
    ATTENTION: Opencv libraries cannot change the device properties 'video format' (such as 'YUYV')
    and fps. These feature are been added only for forward compatibility in the hope they will be
    implemented soon.
   </p>
   <p>
    <image src="imgs/preferences_capture_devices.png"></image>
   </p>   
  </section>
  
  <section id="notes">
   <p><h1>Note</h1></p>
   <p>
    This program is distributed AS IS and without any warranty.
   </p>
   <p>
    The author takes NO RESPONSABILITY for eventual damages.
   </p>
   <p>
    For more legal information see the <a href="gpl-3.0.txt">GNU GPL version 3</a> license.
    You should have received a copy along with this software, if no see the website
    <a href="http://www.gnu.org/licenses">http://www.gnu.org/licenses</a>
   </p>
  </section>
  </div>
  <div class="footpage" id="about">
   <a>lxnstack &copy; 2013 Maurizio D'Addona</a>
  </div>
 </body>
</html>

